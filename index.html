<html lang="de">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>To-Do Liste</title>
</head>
<body>
	<h1>Meine eigene To-Do Liste</h1>
	<h2>Aufgabe erstellen</h2>
	<label for="Aufgabe">Aufgabe: </label><input type="text" maxlength="512" id="Aufgabe"><input type="button" value="Speichern" onclick="erstellen()">
	<p>
	<table id="Tabelle">
  	<tr>
  		<th>ID</th>
	    <th>Aufgabe</th>
    	<th>Erledigt</th>
    	<th></th>
    </tr>
    </table>
</body>
<script>
	tabelleAktualisieren();

 	function tabelleAktualisieren(){
	tabelle = document.getElementById("Tabelle");
 	var anzahlZeilen = tabelle.rows.length;
	for (var i = 1; i < anzahlZeilen; i++) {
    	tabelle.deleteRow(1);
	}

 	fetch('https://webapp.stichels.de/api/getAll').then((response) => response.json()).then((data) => {
 		for(let i = 0; i < data.length; i++) {
    		var zeile = tabelle.insertRow(1);
 			var spalte1 = zeile.insertCell(0)
			var spalte2 = zeile.insertCell(1)
 			var spalte3 = zeile.insertCell(2)
			var spalte4 = zeile.insertCell(3)
			spalte1.innerHTML = data[i][0]; 		
 			spalte2.innerHTML = data[i][1];
 			spalte3.innerHTML = data[i][2]; 		
 			if(data[i][2]==0) 		
 				spalte3.innerHTML = spalte3.innerHTML + '<button type="button" onclick="erledigen('+data[i][0]+')"> Erledigen </button>'
 			spalte4.innerHTML = '<button type="button" onclick="loeschen('+data[i][0]+')"> LÃ¶schen </button>'
		} 		
 		});
 	}
 	function erledigen(number){
 		const data = { Erledigt: 1, ID: number };
 		fetch('https://webapp.stichels.de/api/modify', {
  		method: 'POST', // or 'PUT'
  		headers: {'Content-Type': 'application/json',},
  		body: JSON.stringify(data),
		}).then(tabelleAktualisieren());
 	}

 	function loeschen(number){
 		const data = { ID: number };
 		fetch('https://webapp.stichels.de/api/delete', {
  		method: 'DELETE', // or 'PUT'
  		headers: {'Content-Type': 'application/json',},
  		body: JSON.stringify(data),
		}).then(tabelleAktualisieren());
 	}

 	function erstellen(){
 		const data = { Aufgabe: document.getElementById("Aufgabe").value };
 		console.log(data)
 		fetch('https://webapp.stichels.de/api/create', {
  		method: 'POST', // or 'PUT'
  		headers: {'Content-Type': 'application/json',},
  		body: JSON.stringify(data),
		}).then(()=>{
			tabelleAktualisieren();
			document.getElementById("Aufgabe").value = ''
		});
 	}

 </script>
</html>